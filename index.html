<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sobre Especial</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XZZPNBD62R"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XZZPNBD62R', {
            'page_title': 'Sobre Especial',
            'page_location': window.location.href,
            'page_path': window.location.pathname
        });
    </script>
    <!-- Fin Google Analytics -->
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Importar fuente Pacifico de Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <!-- Iconos para el bot√≥n de m√∫sica -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        /* Mejoras para m√≥vil */
        html, body {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            touch-action: manipulation;
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #1c258b; /* Azul profundo que contrasta bien con el rojo */
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }
        
        #wrapper {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            position: relative;
            text-align: center;
        }
        
        /* Bot√≥n de m√∫sica flotante */
        .music-control {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 82, 82, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: 2px solid white;
        }
        
        .music-control:hover {
            background: rgba(255, 82, 82, 1);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .music-control i {
            font-size: 24px;
            color: white;
        }
        
        .music-control.playing i {
            color: #ffeb3b;
        }
        
        .music-control.pulsing {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 82, 82, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 82, 82, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 82, 82, 0); }
        }
        
        /* Reproductor de m√∫sica avanzado */
        .music-player {
            position: relative;
            margin: 30px auto 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            width: 90%;
            max-width: 350px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none; /* OCULTO POR DEFECTO */
        }
        
        .song-selector {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .song-btn {
            flex: 1;
            padding: 8px 12px;
            background: rgba(255, 82, 82, 0.8);
            border: none;
            border-radius: 25px;
            color: white;
            font-family: 'Pacifico', cursive;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .song-btn:hover {
            background: rgba(255, 82, 82, 1);
            transform: translateY(-2px);
        }
        
        .song-btn.active {
            background: #ffeb3b;
            color: #1c258b;
            box-shadow: 0 4px 15px rgba(255, 235, 59, 0.4);
        }
        
        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .play-pause-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 82, 82, 0.9);
            border: none;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .play-pause-btn:hover {
            background: rgba(255, 82, 82, 1);
            transform: scale(1.1);
        }
        
        .song-info {
            flex: 1;
            text-align: left;
        }
        
        .song-title {
            color: white;
            font-size: 14px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-artist {
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }
        
        .volume-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .volume-control i {
            color: white;
            font-size: 16px;
        }
        
        .volume-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #ff5252;
            cursor: pointer;
        }
        
        /* Notificaci√≥n de m√∫sica */
        .music-notification {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 200px;
            z-index: 999;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
            text-align: center;
        }
        
        .music-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* EL SOBRE (CONTENEDOR) - Color rojo elegante */
        .envelope {
            width: 200px;
            height: 100px;
            margin: 0 auto;
            background: linear-gradient(145deg, #b92424, #ff5252);
            box-shadow: 
                0 0 1px rgba(0,0,0,0.3),
                0 4px 20px rgba(0,0,0,0.25),
                0 15px 40px rgba(255, 82, 82, 0.3),
                0 0 80px rgba(255, 82, 82, 0.15);
            position: relative;
            perspective: 800px;
            cursor: pointer;
            border-radius: 2px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .envelope:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 0 1px rgba(0,0,0,0.3),
                0 6px 25px rgba(0,0,0,0.3),
                0 20px 50px rgba(255, 82, 82, 0.35),
                0 0 100px rgba(255, 82, 82, 0.2);
        }
        
        .envelope:active {
            transform: translateY(0);
        }
        
        .envelope:after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border: 0 solid rgba(0,0,0,0.15);
            border-width: 45px 100px;
            border-top-color: transparent;
            z-index: 2;
        }
        
        .envelope .flap {
            position: absolute;
            width: 100%;
            height: 0;
            border: 0 solid transparent;
            border-width: 50px 100px;
        }
        
        .envelope .flap.front {
            border-left-color: #e26060;
            border-right-color: #e26060;
            border-bottom-color: #e74c3c;
            z-index: 3;
        }
        
        .envelope .flap.front:after {
            content: '';
            width: 100%;
            height: 0;
            position: absolute;
            left: -100px;
            bottom: -50px;
            border: 0 solid transparent;
            border-width: 49px 100px;
            border-bottom-color: #e26060;
        }
        
        .envelope .flap.top {
            border-top-width: 55px;
            border-top-color: #e74c3c;
            z-index: 3;
            animation-duration: 1s;
            animation-fill-mode: forwards;
            transform-origin: top;
            transform-style: preserve-3d;
        }
        
        .envelope.open .flap.top {
            animation-name: flip;
        }
        
        .envelope.closing-step4 .flap.top {
            animation-name: flip-reverse;
            animation-delay: 0s;
        }
        
        .envelope .flap.top:after {
            content: '';
            position: absolute;
            left: -100px;
            top: -55px;
            width: 100%;
            height: 0;
            border: 0 solid transparent;
            border-width: 54px 100px;
            border-top-color: #d33b3b;
        }
        
        .envelope.letter-open .flap.top {
            transform: rotateX(180deg);
            z-index: 1 !important; 
        }
        
        .envelope.closing-step1 .flap.top,
        .envelope.closing-step2 .flap.top,
        .envelope.closing-step3 .flap.top {
            transform: rotateX(180deg);
            z-index: 1 !important;
        }
        
        /* LA CARTA */
        .envelope .letter {
            position: absolute;
            width: 194px;
            height: 84px;
            background: linear-gradient(to bottom, #fff9f9, #fff);
            top: 8px;
            left: 3px;
            border: 1px solid rgba(255, 107, 107, 0.3);
            z-index: 1;
            animation-duration: 2s;
            animation-delay: 1.5s;
            animation-fill-mode: forwards;
            transform-style: preserve-3d;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 10px rgba(255, 107, 107, 0.1);
            border-radius: 1px;
        }

        /* --- ESTILOS DEL TEXTO CON FUENTE PACIFICO --- */
        .letter-content {
            font-family: 'Pacifico', cursive; /* Fuente Pacifico moderna y redondeada */
            font-size: 15px; /* Tama√±o √≥ptimo para Pacifico */
            color: #5d4037;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-align: center;
            pointer-events: none;
            padding: 8px 10px;
            z-index: 10;
            position: relative;
            line-height: 1.4; /* Espaciado entre l√≠neas */
            text-shadow: 0.5px 0.5px 1px rgba(0,0,0,0.1); /* Sombra sutil */
            letter-spacing: 0.2px; /* Espaciado entre letras */
            font-weight: normal; /* Pacifico no tiene pesos diferentes */
        }

        /* --- EMOJIS POSICIONADOS EN EL SOBRE (NO EN LA CARTA) --- */
        .emoji-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .emoji-top, .emoji-bottom {
            position: absolute;
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.5s ease, transform 0.3s ease;
            z-index: 15;
            pointer-events: none;
            left: 50%;
            transform: translateX(-50%);
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
        }

        .emoji-top {
            top: -35px;
        }

        .emoji-bottom {
            bottom: -35px;
        }

        /* Mostrar texto y emojis simult√°neamente */
        .envelope.show-text .letter-content,
        .envelope.show-text .emoji-top,
        .envelope.show-text .emoji-bottom {
            opacity: 1;
        }
        
        .envelope.show-text .emoji-top {
            animation: floatUp 2s ease-in-out infinite;
        }
        
        .envelope.show-text .emoji-bottom {
            animation: floatDown 2s ease-in-out infinite;
        }
        
        /* ANIMACIONES DE LA CARTA */
        .envelope.open .letter {
            animation-name: remove;
        }
        
        .envelope.closing-step3 .letter {
            animation-name: return;
            animation-delay: 0s;
            animation-duration: 1.5s;
            z-index: 1;
        }
        
        .envelope.letter-open .letter {
            top: 8px;
            z-index: 4 !important;
            animation: none !important;
        }
        
        .envelope.closing-step1 .letter,
        .envelope.closing-step2 .letter {
            z-index: 4 !important;
        }
        
        /* PLIEGUES DE LA CARTA */
        .envelope .letter:before,
        .envelope .letter:after {
            content: '';
            position: absolute;
            width: 192px;
            height: 75%;
            left: -1px;
            background: linear-gradient(to bottom, #fff9f9, #fff);
            border: 1px solid rgba(255, 107, 107, 0.3);
            animation-duration: 1s;
            animation-fill-mode: forwards;
            transform-origin: top;
            transform-style: preserve-3d;
        }
        
        .envelope .letter:before {
            z-index: 2;
            transform: rotateX(10deg);
        }
        
        .envelope.open .letter:before {
            animation-name: fold-up;
            animation-delay: 3.5s;
        }
        
        .envelope.closing-step2 .letter:before {
            animation-name: fold-up-reverse;
            animation-delay: 0s;
        }
        
        .envelope.letter-open .letter:before {
            transform: rotateX(140deg);
            animation: none !important;
        }
        
        .envelope.closing-step1 .letter:before {
            transform: rotateX(140deg) !important;
            animation: none !important;
        }
        
        .envelope .letter:after {
            z-index: 2;
            transform-origin: bottom;
            transform: rotateX(-5deg);
            bottom: 0;
        }
        
        .envelope.open .letter:after {
            animation-name: fold-down;
            animation-delay: 4.5s;
        }
        
        .envelope.closing-step1 .letter:after {
            animation-name: fold-down-reverse;
            animation-delay: 0s;
        }
        
        .envelope.letter-open .letter:after {
            transform: rotateX(-140deg);
            animation: none !important;
        }
        
        /* --- KEYFRAMES --- */
        @keyframes flip { 
            100% { transform: rotateX(180deg); z-index: 1; } 
        }
        
        @keyframes flip-reverse { 
            0% { transform: rotateX(180deg); z-index: 1; } 
            100% { transform: rotateX(0deg); z-index: 3; } 
        }
        
        @keyframes remove { 
            0% { top: 8px; z-index: 1; } 
            50% { top: -120px; z-index: 4; } 
            100% { top: 8px; z-index: 4; } 
        }
        
        @keyframes return { 
            0% { top: 8px; z-index: 4; } 
            40% { top: -120px; z-index: 4; } 
            41% { top: -120px; z-index: 1; } 
            100% { top: 8px; z-index: 1; } 
        }
        
        @keyframes fold-up { 
            0% { transform: rotateX(10deg); } 
            100% { transform: rotateX(140deg); } 
        }
        
        @keyframes fold-up-reverse { 
            0% { transform: rotateX(140deg); } 
            100% { transform: rotateX(10deg); } 
        }
        
        @keyframes fold-down { 
            0% { transform: rotateX(-5deg); } 
            100% { transform: rotateX(-140deg); } 
        }
        
        @keyframes fold-down-reverse { 
            0% { transform: rotateX(-140deg); } 
            100% { transform: rotateX(-5deg); } 
        }
        
        @keyframes floatUp {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-5px); }
        }
        
        @keyframes floatDown {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(5px); }
        }

        /* Animaciones espec√≠ficas para m√≥vil */
        @keyframes floatUpMobile {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }

        @keyframes floatDownMobile {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(3px); }
        }
        
        /* Media queries para m√≥vil */
        @media (max-width: 768px) {
            body {
                padding: 15px;
                background: #1a237e;
            }
            
            .envelope {
                transform: scale(1.3);
                margin: 0 auto;
            }
            
            .envelope:hover {
                transform: scale(1.3) translateY(-2px);
            }
            
            .envelope:active {
                transform: scale(1.3) translateY(0);
            }
            
            .letter-content {
                font-size: 16px; /* Un poco m√°s grande en m√≥vil */
                padding: 6px 8px;
            }
            
            /* CORRECCI√ìN PARA LOS EMOJIS EN M√ìVIL */
            .emoji-top, .emoji-bottom {
                font-size: 18px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
            }
            
            /* Ajustar posici√≥n del emoji superior para que no se salga */
            .emoji-top {
                top: -28px; /* Reducido de -35px a -28px */
            }
            
            .emoji-bottom {
                bottom: -28px; /* Reducido de -35px a -28px */
            }
            
            /* Ajustar las animaciones para la nueva posici√≥n */
            .envelope.show-text .emoji-top {
                animation: floatUpMobile 2s ease-in-out infinite;
            }
            
            .envelope.show-text .emoji-bottom {
                animation: floatDownMobile 2s ease-in-out infinite;
            }
            
            /* Ajustes para el bot√≥n de m√∫sica en m√≥vil */
            .music-control {
                bottom: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
            }
            
            .music-control i {
                font-size: 20px;
            }
            
            .music-notification {
                bottom: 70px;
                right: 15px;
                font-size: 12px;
                max-width: 180px;
                padding: 8px 12px;
            }
            
            /* Ajustes para el reproductor en m√≥vil */
            .music-player {
                margin: 20px auto 0;
                padding: 12px;
                width: 95%;
            }
            
            .song-selector {
                flex-direction: column;
                gap: 8px;
            }
            
            .song-btn {
                padding: 10px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 480px) {
            .envelope {
                transform: scale(1.2);
            }
            
            .envelope:hover {
                transform: scale(1.2) translateY(-2px);
            }
            
            .envelope:active {
                transform: scale(1.2) translateY(0);
            }
            
            .letter-content {
                font-size: 15px; /* Tama√±o √≥ptimo para pantallas muy peque√±as */
            }
            
            /* Ajustar a√∫n m√°s para pantallas muy peque√±as */
            .emoji-top, .emoji-bottom {
                font-size: 16px;
            }
            
            .emoji-top {
                top: -25px;
            }
            
            .emoji-bottom {
                bottom: -25px;
            }
            
            /* Ajustes para pantallas muy peque√±as */
            .music-control {
                bottom: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
            }
            
            .music-control i {
                font-size: 18px;
            }
            
            .music-notification {
                bottom: 60px;
                right: 10px;
                font-size: 11px;
                max-width: 160px;
                padding: 6px 10px;
            }
            
            .music-player {
                margin: 15px auto 0;
                padding: 10px;
            }
            
            .song-btn {
                font-size: 12px;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div id="wrapper">
        <div class="envelope">
            <div class="flap front"></div>
            <div class="flap top"></div>
            <div class="letter">
                <div class="letter-content" id="texto-carta"></div>
            </div>
            <!-- Contenedor para los emojis, fuera de la carta pero dentro del sobre -->
            <div class="emoji-container">
                <div class="emoji-top" id="emoji-top"></div>
                <div class="emoji-bottom" id="emoji-bottom"></div>
            </div>
        </div>
        
        <!-- Reproductor de m√∫sica (INICIALMENTE OCULTO) -->
        <div class="music-player" id="musicPlayer">
            <div class="song-selector">
                <button class="song-btn" data-song="1">
                    <i class="fas fa-music"></i> Sonr√≠e
                </button>
                <button class="song-btn" data-song="2">
                    <i class="fas fa-heart"></i> Love
                </button>
                <button class="song-btn" data-song="3">
                    <i class="fas fa-star"></i> I Adore You
                </button>
            </div>
            
            <div class="player-controls">
                <button class="play-pause-btn" id="playPauseBtn">
                    <i class="fas fa-play"></i>
                </button>
                <div class="song-info">
                    <div class="song-title" id="currentSongTitle">Selecciona una canci√≥n</div>
                    <div class="song-artist" id="currentSongArtist">Tu m√∫sica especial</div>
                </div>
            </div>
            
            <div class="volume-control">
                <i class="fas fa-volume-down"></i>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                <i class="fas fa-volume-up"></i>
            </div>
        </div>
    </div>
    
    <!-- Bot√≥n de control de m√∫sica flotante -->
    <div class="music-control" id="musicControl">
        <i class="fas fa-music"></i>
    </div>
    
    <!-- Notificaci√≥n de m√∫sica -->
    <div class="music-notification" id="musicNotification">
        M√∫sica activada. ¬°Disfruta de la experiencia!
    </div>
    
    <!-- Elementos de audio para las canciones -->
    <audio id="song1" preload="auto">
        <source src="https://ionut5251.github.io/Notitas/cancion.mp3" type="audio/mpeg">
    </audio>
    <audio id="song2" preload="auto">
        <source src="https://ionut5251.github.io/Notitas/cancion2.mp3" type="audio/mpeg">
    </audio>
    <audio id="song3" preload="auto">
        <source src="https://ionut5251.github.io/Notitas/cancionadore.mp3" type="audio/mpeg">
    </audio>

    <script>
        $(document).ready(function() {
            let sobreAbierto = false;
            let animando = false;
            let animacionAbiertaCompleta = false;
            let mensajesSeguidos = 0;
            let ultimoMensajeTiempo = 0;
            
            // --- L√ìGICA DE TEXTOS ALEATORIOS CON EMOJIS ASIGNADOS ---
            const textosConEmojis = [
                {
                    texto: "Keep shining!",
                    emoji: "‚ú®" 
                },
                {
                    texto: "Hoy te ves incre√≠ble!", 
                    emoji: "üòç" 
                },
                {
                    texto: "Sonrie!",
                    emoji: "üòä" 
                },
                {
                    texto: "Tienes una sonrisa especial!",
                    emoji: "ü•∞" 
                },
                {
                    texto: "Beautiful smile!",
                    emoji: "ü§ó" 
                },
                {
                    texto: "Eres mi pensamiento favorito.",
                    emoji: "üí≠"  
                },
                {
                    texto: "Haces que todo sea m√°s bonito.",
                    emoji: "üåà"  
                },
                {
                    texto: "Mi lugar favorito eres t√∫!",
                    emoji: "‚≠êÔ∏è"  
                },
                {
                    texto: "¬°T√∫ puedes con todo hoy!",
                    emoji: "üí™üèº"  
                },
                {
                    texto: "Que nada te quite esa sonrisa!",
                    emoji: "üíô" 
                },
                {
                    texto: "Cualquier d√≠a se vuelve m√°s bonito cuando te veo sonre√≠r.",
                    emoji: "üå∏" 
                },
                {
                    texto: "Tu sonrisa es mi luz.",
                    emoji: "üåü" 
                },
                {
                    texto: "Tu esencia alegra todo.",
                    emoji: "üå∑" 
                },
                {
                    texto: "Me encantas exactamente como eres!",
                    emoji: "üíñ" 
                },
                {
                    texto: "You are my favorite smile!",
                    emoji: "üòò" 
                },
                {
                    texto: "Es imposible no sonre√≠r contigo.",
                    emoji: "üòå"  
                },
                {
                    texto: "Eres m√°s incre√≠ble de lo que crees!",
                    emoji: "üöÄ" 
                },
                {
                    texto: "Tu risa es mi melod√≠a favorita.",
                    emoji: "üéµ"
                },
                {
                    texto: "Contigo todo tiene m√°s color.",
                    emoji: "üé®"
                },
                {
                    texto: "Eres la raz√≥n de mi sonrisa hoy.",
                    emoji: "üòä"
                }
            ];
            
            // Copia de la lista para ir quitando los que ya salieron
            let textosDisponibles = [...textosConEmojis];

            function obtenerTextoYEmojiAleatorio() {
                // Si nos quedamos sin textos, reiniciamos la lista
                if (textosDisponibles.length === 0) {
                    textosDisponibles = [...textosConEmojis];
                }
                
                // Elegimos un √≠ndice al azar de los disponibles
                const indice = Math.floor(Math.random() * textosDisponibles.length);
                // Extraemos el texto y emoji de la lista (sac√°ndolo con splice)
                const textoElegido = textosDisponibles.splice(indice, 1)[0];
                
                return textoElegido;
            }
            
            // Funci√≥n simplificada para mensajes seguidos (sin efectos visuales)
            function verificarMensajesSeguidos() {
                const ahora = Date.now();
                
                // Si pasaron menos de 10 segundos desde el √∫ltimo mensaje
                if (ahora - ultimoMensajeTiempo < 10000) {
                    mensajesSeguidos++;
                    console.log(`üìä Mensajes seguidos: ${mensajesSeguidos}`);
                } else {
                    // Reiniciar contador si pas√≥ mucho tiempo
                    mensajesSeguidos = 0;
                }
                
                ultimoMensajeTiempo = ahora;
            }
            
            function abrirSobre() {
                if (animando) return;
                animando = true;
                animacionAbiertaCompleta = false;
                
                // Obtenemos texto y emoji aleatorio
                const contenido = obtenerTextoYEmojiAleatorio();
                
                // Inyectamos el nuevo texto antes de empezar la animaci√≥n
                $('#texto-carta').text(contenido.texto);
                
                // Asignamos el emoji correspondiente tanto arriba como abajo
                $('#emoji-top').text(contenido.emoji);
                $('#emoji-bottom').text(contenido.emoji);
                
                // Verificar mensajes seguidos (sin efectos visuales)
                verificarMensajesSeguidos();
                
                // Registrar evento en Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'sobre_abierto', {
                        'event_category': 'interaccion',
                        'event_label': contenido.texto,
                        'value': 1
                    });
                }
                
                // Registrar la visita localmente
                registrarVisitaLocal(contenido.texto, contenido.emoji);
                
                $('.envelope').removeClass('letter-open closing-step1 closing-step2 closing-step3 closing-step4 show-text');
                $('.envelope').addClass('open');
                sobreAbierto = true;
                
                setTimeout(function() {
                    $('.envelope').removeClass('open').addClass('letter-open');
                    
                    setTimeout(function() {
                        // Al a√±adir show-text, tanto el texto como los emojis aparecer√°n
                        $('.envelope').addClass('show-text');
                        animacionAbiertaCompleta = true;
                        animando = false;
                    }, 500);
                }, 6000);
            }
            
            function iniciarCierre() {
                if (animando || !sobreAbierto) return;
                animando = true;
                
                // Al quitar show-text, el texto y los emojis desaparecen
                $('.envelope').removeClass('show-text');
                
                setTimeout(function() {
                    if (!animacionAbiertaCompleta) {
                        $('.envelope').removeClass('open').addClass('letter-open');
                    }
                    
                    $('.envelope').removeClass('letter-open').addClass('closing-step1');
                    
                    setTimeout(function() {
                        $('.envelope').removeClass('closing-step1').addClass('closing-step2');
                        
                        setTimeout(function() {
                            $('.envelope').removeClass('closing-step2').addClass('closing-step3');
                            
                            setTimeout(function() {
                                $('.envelope').removeClass('closing-step3').addClass('closing-step4');
                                sobreAbierto = false;
                                animacionAbiertaCompleta = false;
                                
                                setTimeout(function() {
                                    $('.envelope').removeClass('closing-step4');
                                    // Limpiamos el texto y emojis al terminar de cerrar
                                    $('#texto-carta').text('');
                                    $('#emoji-top').text('');
                                    $('#emoji-bottom').text('');
                                    animando = false;
                                }, 1000);
                            }, 1500);
                        }, 1000);
                    }, 1000);
                }, 500);
            }
            
            $('.envelope').click(function() {
                if (sobreAbierto) iniciarCierre();
                else abrirSobre();
            });
            
            $('.envelope').on('touchstart', function(e) {
                e.preventDefault();
                if (sobreAbierto) iniciarCierre();
                else abrirSobre();
            });
            
            // ==============================================
            // SISTEMA DE M√öSICA AVANZADO (CORREGIDO)
            // ==============================================
            
            // Elementos del reproductor
            const songs = [
                {
                    id: 1,
                    title: "Sonr√≠e",
                    artist: "M√∫sica para ti",
                    element: document.getElementById('song1'),
                    button: $('.song-btn[data-song="1"]')
                },
                {
                    id: 2,
                    title: "Love",
                    artist: "Canci√≥n rom√°ntica",
                    element: document.getElementById('song2'),
                    button: $('.song-btn[data-song="2"]')
                },
                {
                    id: 3,
                    title: "I Adore You",
                    artist: "Para sonre√≠r",
                    element: document.getElementById('song3'),
                    button: $('.song-btn[data-song="3"]')
                }
            ];
            
            let currentSongIndex = 0;
            let isPlaying = false;
            let wasPlayingBeforeHidden = false;
            const musicNotification = document.getElementById('musicNotification');
            
            // Funci√≥n para cambiar canci√≥n
            function changeSong(songIndex) {
                // Pausar canci√≥n actual
                songs[currentSongIndex].element.pause();
                songs[currentSongIndex].button.removeClass('active');
                
                // Cambiar a nueva canci√≥n
                currentSongIndex = songIndex;
                const currentSong = songs[currentSongIndex];
                
                // Actualizar interfaz
                currentSong.button.addClass('active');
                $('#currentSongTitle').text(currentSong.title);
                $('#currentSongArtist').text(currentSong.artist);
                
                // Registrar evento en Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'cancion_cambiada', {
                        'event_category': 'musica',
                        'event_label': currentSong.title,
                        'value': songIndex
                    });
                }
                
                // Si estaba reproduciendo, iniciar nueva canci√≥n
                if (isPlaying) {
                    currentSong.element.currentTime = 0;
                    currentSong.element.play().then(() => {
                        // Actualizar icono de play/pause a pause
                        $('#playPauseBtn i').removeClass('fa-play').addClass('fa-pause');
                    }).catch(error => {
                        console.log("Error al reproducir:", error);
                    });
                }
                
                // Guardar preferencia
                localStorage.setItem('selectedSong', currentSongIndex);
            }
            
            // Funci√≥n para play/pause (CORREGIDA)
            function togglePlayPause() {
                const currentSong = songs[currentSongIndex];
                const playPauseIcon = $('#playPauseBtn i');
                
                if (isPlaying) {
                    currentSong.element.pause();
                    playPauseIcon.removeClass('fa-pause').addClass('fa-play');
                    showNotification("M√∫sica pausada");
                    
                    // Registrar evento en Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'musica_pausada', {
                            'event_category': 'musica',
                            'event_label': currentSong.title
                        });
                    }
                } else {
                    currentSong.element.play().then(() => {
                        playPauseIcon.removeClass('fa-play').addClass('fa-pause');
                        showNotification(`Reproduciendo: ${currentSong.title}`);
                        
                        // Registrar evento en Google Analytics
                        if (typeof gtag !== 'undefined') {
                            gtag('event', 'musica_iniciada', {
                                'event_category': 'musica',
                                'event_label': currentSong.title
                            });
                        }
                    }).catch(error => {
                        console.log("Error al reproducir:", error);
                        showNotification("Haz clic en el sobre primero para activar la m√∫sica");
                        // Si hay error, mantener icono de play
                        isPlaying = false;
                    });
                }
                
                isPlaying = !isPlaying;
                localStorage.setItem('musicPlaying', isPlaying);
            }
            
            // Funci√≥n para mostrar notificaci√≥n
            function showNotification(message) {
                musicNotification.textContent = message;
                musicNotification.classList.add('show');
                
                setTimeout(function() {
                    musicNotification.classList.remove('show');
                }, 3000);
            }
            
            // Funci√≥n para actualizar volumen
            function updateVolume(value) {
                const volume = value / 100;
                songs.forEach(song => {
                    song.element.volume = volume;
                });
                localStorage.setItem('musicVolume', value);
            }
            
            // Inicializar reproductor
            function initializePlayer() {
                // Cargar preferencias
                const savedSong = localStorage.getItem('selectedSong');
                const savedVolume = localStorage.getItem('musicVolume');
                const savedPlaying = localStorage.getItem('musicPlaying');
                
                if (savedSong !== null) {
                    changeSong(parseInt(savedSong));
                } else {
                    songs[currentSongIndex].button.addClass('active');
                    $('#currentSongTitle').text(songs[currentSongIndex].title);
                    $('#currentSongArtist').text(songs[currentSongIndex].artist);
                }
                
                if (savedVolume !== null) {
                    $('#volumeSlider').val(savedVolume);
                    updateVolume(savedVolume);
                } else {
                    updateVolume(50);
                }
                
                if (savedPlaying === 'true') {
                    isPlaying = true;
                    $('#playPauseBtn i').removeClass('fa-play').addClass('fa-pause');
                    // Intentar reproducir la canci√≥n
                    setTimeout(() => {
                        songs[currentSongIndex].element.play().catch(e => {
                            console.log("No se pudo reproducir autom√°ticamente:", e);
                            isPlaying = false;
                            $('#playPauseBtn i').removeClass('fa-pause').addClass('fa-play');
                        });
                    }, 500);
                }
                
                // Configurar eventos de fin de canci√≥n
                songs.forEach((song, index) => {
                    song.element.addEventListener('ended', () => {
                        if (isPlaying) {
                            // Repetir la misma canci√≥n (loop)
                            song.element.currentTime = 0;
                            song.element.play();
                        }
                    });
                    
                    // Actualizar estado cuando se pausa manualmente
                    song.element.addEventListener('pause', () => {
                        // Solo cambiar icono si no estamos cambiando de canci√≥n
                        if (isPlaying && currentSongIndex === index) {
                            isPlaying = false;
                            $('#playPauseBtn i').removeClass('fa-pause').addClass('fa-play');
                        }
                    });
                    
                    // Actualizar estado cuando se reanuda
                    song.element.addEventListener('play', () => {
                        if (!isPlaying && currentSongIndex === index) {
                            isPlaying = true;
                            $('#playPauseBtn i').removeClass('fa-play').addClass('fa-pause');
                        }
                    });
                });
            }
            
            // Event listeners para controles de m√∫sica
            $('.song-btn').click(function() {
                const songIndex = parseInt($(this).data('song')) - 1;
                changeSong(songIndex);
            });
            
            $('#playPauseBtn').click(function() {
                togglePlayPause();
            });
            
            $('#volumeSlider').on('input', function() {
                updateVolume($(this).val());
            });
            
            // BOT√ìN CORREGIDO: Funciona con un solo clic/toque
            $('#musicControl').click(function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                // Alternar visibilidad del reproductor
                if ($('#musicPlayer').is(':visible')) {
                    $('#musicPlayer').slideUp(300);
                } else {
                    $('#musicPlayer').slideDown(300);
                }
                
                $(this).toggleClass('pulsing');
                
                // Registrar evento en Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'reproductor_toggle', {
                        'event_category': 'interfaz'
                    });
                }
                
                return false;
            });
            
            // Control t√°ctil para m√≥viles (CORREGIDO)
            $('#musicControl').on('touchstart', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                // Alternar visibilidad del reproductor
                if ($('#musicPlayer').is(':visible')) {
                    $('#musicPlayer').slideUp(300);
                } else {
                    $('#musicPlayer').slideDown(300);
                }
                
                $(this).toggleClass('pulsing');
                return false;
            });
            
            // Prevenir que otros eventos interfieran
            $('#musicControl').on('touchmove', function(e) {
                e.preventDefault();
            });
            
            // --- DETECCI√ìN DE VISIBILIDAD DE LA P√ÅGINA ---
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    // La p√°gina ya no es visible
                    if (isPlaying) {
                        wasPlayingBeforeHidden = true;
                        songs[currentSongIndex].element.pause();
                    }
                } else {
                    // La p√°gina es visible nuevamente
                    if (wasPlayingBeforeHidden) {
                        wasPlayingBeforeHidden = false;
                        if (isPlaying) {
                            songs[currentSongIndex].element.play().catch(console.error);
                        }
                    }
                }
            });
            
            // Detectar cuando la ventana pierde el foco
            window.addEventListener('blur', function() {
                if (isPlaying) {
                    wasPlayingBeforeHidden = true;
                    songs[currentSongIndex].element.pause();
                }
            });
            
            // Restaurar cuando la ventana recupera el foco
            window.addEventListener('focus', function() {
                if (wasPlayingBeforeHidden && isPlaying) {
                    wasPlayingBeforeHidden = false;
                    songs[currentSongIndex].element.play().catch(console.error);
                }
            });
            
            // ==============================================
            // SISTEMA DE REGISTRO LOCAL DE VISITAS
            // ==============================================
            
            // Funci√≥n para registrar visita localmente
            async function registrarVisitaLocal(mensaje, emoji) {
                try {
                    // Crear objeto de visita
                    const visita = {
                        fecha: new Date().toLocaleDateString('es-ES'),
                        hora: new Date().toLocaleTimeString('es-ES'),
                        timestamp: Date.now(),
                        mensaje: mensaje,
                        emoji: emoji,
                        dispositivo: /Mobi|Android/i.test(navigator.userAgent) ? 'm√≥vil' : 'desktop',
                        navegador: navigator.userAgent.substring(0, 100),
                        ip: await obtenerIP()
                    };
                    
                    console.log('üìù Registrando visita local:', visita);
                    
                    // Guardar en localStorage
                    guardarVisitaLocalStorage(visita);
                    
                    // Registrar evento en Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'mensaje_visto', {
                            'event_category': 'contenido',
                            'event_label': mensaje.substring(0, 30),
                            'value': 1
                        });
                    }
                    
                } catch (error) {
                    console.error('Error al registrar visita local:', error);
                }
            }
            
            // Funci√≥n para obtener IP aproximada
            async function obtenerIP() {
                try {
                    const response = await fetch('https://api.ipify.org?format=json');
                    const data = await response.json();
                    return data.ip;
                } catch (error) {
                    return 'Desconocida';
                }
            }
            
            // Funci√≥n para guardar visita en localStorage
            function guardarVisitaLocalStorage(visita) {
                try {
                    let historial = JSON.parse(localStorage.getItem('historial_visitas') || '[]');
                    historial.push(visita);
                    
                    // Limitar a 100 registros para no saturar
                    if (historial.length > 100) {
                        historial = historial.slice(-100);
                    }
                    
                    localStorage.setItem('historial_visitas', JSON.stringify(historial));
                    localStorage.setItem('ultima_visita', JSON.stringify(visita));
                    
                    // Mostrar resumen en consola
                    mostrarResumenLocal();
                    
                } catch (error) {
                    console.error('Error al guardar visita local:', error);
                }
            }
            
            // Funci√≥n para mostrar resumen local
            function mostrarResumenLocal() {
                const historial = JSON.parse(localStorage.getItem('historial_visitas') || '[]');
                if (historial.length > 0) {
                    console.log(`üìä Visitando local: ${historial.length} registradas`);
                    const hoy = new Date().toLocaleDateString('es-ES');
                    const hoyCount = historial.filter(v => v.fecha === hoy).length;
                    console.log(`üìÖ Hoy (${hoy}): ${hoyCount} visita(s)`);
                    
                    // Mostrar √∫ltimos 5 mensajes
                    console.log('üìù √öltimos mensajes:');
                    historial.slice(-5).reverse().forEach((v, i) => {
                        console.log(`   ${v.hora}: "${v.mensaje}" ${v.emoji}`);
                    });
                }
            }
            
            // Funci√≥n para exportar datos locales
            function exportarDatosLocales() {
                const historial = JSON.parse(localStorage.getItem('historial_visitas') || '[]');
                const datos = {
                    exportado: new Date().toISOString(),
                    total: historial.length,
                    visitas: historial
                };
                
                const blob = new Blob([JSON.stringify(datos, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `visitas-local-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                console.log('üìÅ Datos locales exportados');
                showNotification("Datos exportados a archivo JSON");
            }
            
            // Funci√≥n para ver estad√≠sticas
            function verEstadisticas() {
                const historial = JSON.parse(localStorage.getItem('historial_visitas') || '[]');
                
                console.clear();
                console.log('%cüìä ===== ESTAD√çSTICAS LOCALES =====', 'color: #ff5252; font-size: 16px; font-weight: bold');
                console.log(`%cTotal mensajes vistos: ${historial.length}`, 'color: #4CAF50');
                
                if (historial.length > 0) {
                    // Contar por fecha
                    const porFecha = {};
                    historial.forEach(v => {
                        porFecha[v.fecha] = (porFecha[v.fecha] || 0) + 1;
                    });
                    
                    console.log('\n%cüìÖ VISITAS POR FECHA:', 'color: #9C27B0; font-weight: bold');
                    Object.entries(porFecha).forEach(([fecha, count]) => {
                        console.log(`   ${fecha}: ${count} mensaje(s)`);
                    });
                    
                    // Mostrar √∫ltimos 15 mensajes
                    console.log('\n%cüìã √öLTIMOS MENSAJES:', 'color: #FF9800; font-weight: bold');
                    historial.slice(-15).reverse().forEach((visita, index) => {
                        const num = historial.length - index;
                        console.log(`\n${num}. ${visita.fecha} - ${visita.hora}`);
                        console.log(`   üíå "${visita.mensaje}" ${visita.emoji}`);
                        console.log(`   üì± ${visita.dispositivo}`);
                        console.log(`   üåê ${visita.navegador.split(' ')[0]}`);
                    });
                }
                
                console.log('\n%c====================================', 'color: #ff5252; font-weight: bold');
                console.log('üìù Usa exportarDatosLocales() para exportar');
                
                showNotification("Estad√≠sticas mostradas en consola");
            }
            
            // Inicializar todo
            setTimeout(async function() {
                // Inicializar reproductor
                initializePlayer();
                
                // Registrar primera visita
                if (!sessionStorage.getItem('visita_registrada')) {
                    await registrarVisitaLocal('P√°gina cargada', 'üì±');
                    sessionStorage.setItem('visita_registrada', 'true');
                    
                    // Registrar p√°gina cargada en Google Analytics
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'page_load', {
                            'event_category': 'navegacion',
                            'value': 1
                        });
                    }
                }
                
                // Mostrar notificaci√≥n
                showNotification("¬°Descubre mensajes especiales!");
                $('#musicControl').addClass('pulsing');
                
                // Reproductor ya est√° oculto por CSS (display: none)
                // No necesitamos esconderlo con JavaScript
                
                setTimeout(function() {
                    $('#musicControl').removeClass('pulsing');
                }, 10000);
                
                // Instrucciones en consola
                console.log('üéµ REPRODUCTOR DE M√öSICA - 3 canciones');
                console.log('üìä SISTEMA DE VISITAS LOCAL ACTIVO');
                console.log('‚Ä¢ Cada mensaje se guarda en localStorage');
                console.log('‚Ä¢ Para ver estad√≠sticas: verEstadisticas()');
                console.log('‚Ä¢ Para exportar locales: exportarDatosLocales()');
                console.log('üìà Google Analytics activo para seguimiento');
                
                // Hacer funciones accesibles
                window.verEstadisticas = verEstadisticas;
                window.exportarDatosLocales = exportarDatosLocales;
                window.mostrarResumenLocal = mostrarResumenLocal;
                
            }, 2000);
        });
    </script>
</body>
</html>